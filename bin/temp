#!/bin/bash -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH
#source "${OPENSHIFT_RUBY_DIR}/lib/util"
source "${OPENSHIFT_RUBY_DIR}/lib/ruby_context"
source "${OPENSHIFT_RUBY_DIR}/lib/servers"

HTTPD_CFG_FILE=$OPENSHIFT_RUBY_DIR/etc/conf/httpd_nolog.conf
HTTPD_PID_FILE=$OPENSHIFT_RUBY_DIR/run/httpd.pid

function start() {
    echo "Starting Ruby cartridge"
    
    if ! is_server_installed $OPENSHIFT_SERVER
    then
      ${OPENSHIFT_RUBY_DIR}/servers/${OPENSHIFT_SERVER}/install
    fi

    pushd $OPENSHIFT_REPO_DIR 1>/dev/null
    ${OPENSHIFT_RUBY_DIR}/servers/${OPENSHIFT_SERVER}/control/start
    popd 1>/dev/null    
}